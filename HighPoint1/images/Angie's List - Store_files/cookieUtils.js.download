'use strict';

define(function (require) {
  var moment = require('moment');
  var _ = require('underscore');

  return {
    getCookie: function getCookie(key) {
      var allCookies = window.document.cookie;
      var pairs = allCookies.split(';');
      var value = _.find(pairs, function (pair) {
        return _.trim(pair.split('=')[0]) === key;
      });
      return value ? value.split('=')[1] : '';
    },

    setCookie: function setCookie(key, value, expires) {
      var expireDate = new Date();
      expireDate.setTime(expireDate.getTime() + expires * 24 * 60 * 60 * 1000); // expire cookie in 7 days
      document.cookie = key + '=' + value + ';path=/;expires=' + expireDate + ';';
    },

    getCookieValue: function getCookieValue(key) {
      var value = void 0;
      var cookies = document.cookie.split(';');
      cookies.map(function (cookie) {
        var cookieKey = cookie.split('=')[0].trim();
        var cookieVal = cookie.split('=')[1];
        if (cookieKey === key) {
          value = cookieVal;
        }
      });
      return value;
    },

    getCookieJson: function getCookieJson(key) {
      var stringifiedValue = this.getCookieValue(key);
      if (stringifiedValue) {
        return JSON.parse(stringifiedValue);
      }
      return {};
    },

    validate24HourSession: function validate24HourSession(key) {
      var value = this.getCookieJson(key);
      if (value) {
        return moment().isBefore(moment(value.created).add(1, 'days'));
      }
      return false;
    },

    saveSessionCookie: function saveSessionCookie(key, value) {
      document.cookie = key + '=' + value + ';expires=0;path=/';
    },

    saveCookie: function saveCookie(key, value, expires) {
      document.cookie = key + '=' + value + ';expires=' + expires + ';path=/';
    },

    save24HourSessionCookie: function save24HourSessionCookie(key, value) {
      var created = moment().format();
      var data = JSON.stringify({
        value: value,
        created: created
      });
      document.cookie = key + '=' + data + ';path=/';
    },

    deleteCookie: function deleteCookie(key) {
      document.cookie = key + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/';
    }
  };
});