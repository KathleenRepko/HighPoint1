define(function (require) {
  /* eslint no-var:0 */
  /* eslint prefer-rest-params:0 */
  var $ = require('jquery');
  var _ = require('underscore');
  var Backbone = require('backbone');

  // When this code is included, "screenBreak" events are triggered on the
  // "responsive" object whenever the screen size string changes.

  // In the future when IE10 is dead we can pull the current media screen size
  // CSS file with window.getComputedStyle calls. Until then, the breakpoints
  // need to be hardcoded both here and in the variables.less file.

  var breakpointList = [
    {label: 'screen-xs', width: 480},
    {label: 'screen-sm', width: 768},
    {label: 'screen-md', width: 992},
    {label: 'screen-lg', width: 1200}
  ];

  var responsive = {
    getMediaSize: function () {
      var screenWidth = $(window).width();
      return _(breakpointList).find(function (breakpoint) {
        return screenWidth <= breakpoint.width;
      }) || breakpointList[breakpointList.length - 1];
    },

    getMediaName: function () {
      return (this.getMediaSize() || {}).label;
    },

    is: function () {
      var names = [].slice.apply(arguments);
      return names.indexOf(this.getMediaName()) >= 0;
    }
  };

  _.extend(responsive, Backbone.Events);

  var previousScreenSize = responsive.getMediaSize();

  $(window).resize(_.debounce(function () {
    var currentScreenSize = responsive.getMediaSize();
    if (currentScreenSize.label !== previousScreenSize.label) {
      responsive.trigger('screenBreak', currentScreenSize, previousScreenSize);
      previousScreenSize = currentScreenSize;
    }
  }, 250));

  return responsive;
});
