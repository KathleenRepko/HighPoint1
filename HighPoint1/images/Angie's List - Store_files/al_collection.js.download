define(function (require) {
  var Backbone = require('backbone');

  /* eslint no-var:0 */
  return Backbone.Collection.extend({

    // By convention, the API must return a field `collectionName` for
    // endpoint (URL) `.../collection_name`
    parse: function (response) {
      var url = document.createElement('a');
      url.href = typeof (this.url) === 'function' ? this.url() : this.url;

      var path = url.pathname.replace(/\/$/, '');

      var endpoint = path.substring(path.lastIndexOf('/') + 1);

      var collection = endpoint.replace(/_(.)/g, function (match, c) {
        return c.toUpperCase();
      });

      return response[collection];
    }
  });
});
